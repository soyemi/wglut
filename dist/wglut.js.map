{"version":3,"file":"wglut.js","sources":["../src/GLProgram.ts","../src/GLContext.ts"],"sourcesContent":["\r\n\r\nexport class GLProgram{\r\n\r\n    public Program: WebGLProgram;\r\n\r\n    public Attributes: { [key: string]: number } = {};\r\n    public Unifroms: { [key: string]: WebGLUniformLocation | null } = {};\r\n\r\n    public GetUnifrom(key:string):WebGLUniformLocation | null{\r\n        return this.Unifroms[key];\r\n    }\r\n\r\n    public GetAttribute(key:string):any{\r\n        return this.Attributes[key];\r\n    }\r\n\r\n    public constructor(gl: WebGLRenderingContext, program: WebGLProgram) {\r\n        this.Program = program;\r\n\r\n        const numAttrs = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\r\n        for (let i = 0; i < numAttrs; i++) {\r\n            const attrInfo = gl.getActiveAttrib(program, i);\r\n            if (attrInfo == null) continue;\r\n            const attrLoca = gl.getAttribLocation(program, attrInfo.name);\r\n            this.Attributes[attrInfo.name] = attrLoca;\r\n        }\r\n\r\n        const numUniform = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\r\n        for (let i = 0; i < numUniform; i++) {\r\n            const uniformInfo = gl.getActiveUniform(program, i);\r\n            if (uniformInfo == null) continue;\r\n            const uniformLoca = gl.getUniformLocation(program, uniformInfo.name);\r\n            this.Unifroms[uniformInfo.name] = uniformLoca;\r\n        }\r\n    }\r\n}","import { GLProgram } from \"./GLProgram\";\r\n\r\nexport class GLContext{\r\n\r\n    public gl:WebGL2RenderingContext;\r\n    private constructor(wgl:WebGL2RenderingContext){\r\n        this.gl = wgl;\r\n    }\r\n\r\n    public static createFromGL(wgl:WebGL2RenderingContext) :GLContext{\r\n        return new GLContext(wgl);\r\n    }\r\n\r\n    public static createFromCanvas(canvas:HTMLCanvasElement):GLContext | null{\r\n        let g:any = canvas.getContext('webgl2');\r\n        if(g == null){\r\n            g = canvas.getContext('webgl');\r\n        }\r\n        if(g == null) return null;\r\n        return new GLContext(g);\r\n    }\r\n\r\n    public createProgram(vsource:string,psource:string): GLProgram | null{\r\n\r\n        let gl = this.gl;\r\n        let vs = gl.createShader(gl.VERTEX_SHADER);\r\n        gl.shaderSource(vs, vsource);\r\n        gl.compileShader(vs);\r\n\r\n        if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {\r\n            console.error('compile vertex shader failed: ' + gl.getShaderInfoLog(vs));\r\n            gl.deleteShader(vs);\r\n            return null;\r\n        }\r\n\r\n        let ps = gl.createShader(gl.FRAGMENT_SHADER);\r\n        gl.shaderSource(ps, psource);\r\n        gl.compileShader(ps);\r\n\r\n        if (!gl.getShaderParameter(ps, gl.COMPILE_STATUS)) {\r\n            console.error('compile fragment shader failed: ' + gl.getShaderInfoLog(ps));\r\n            gl.deleteShader(ps);\r\n            return null;\r\n        }\r\n\r\n        let program = gl.createProgram();\r\n        gl.attachShader(program, vs);\r\n        gl.attachShader(program, ps);\r\n        gl.linkProgram(program);\r\n\r\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n            console.error('link shader program failed!:' + gl.getProgramInfoLog(program));\r\n            gl.deleteProgram(program);\r\n            gl.deleteShader(vs);\r\n            gl.deleteShader(ps);\r\n            return null;\r\n        }\r\n\r\n        if(program == null) return null;\r\n\r\n        let p = new GLProgram(gl, program);\r\n        let handler = {\r\n            get: function(tar:GLProgram | any,name:string){\r\n                if(name in tar) return tar[name];\r\n\r\n                if(name in tar.Unifroms){\r\n                    tar[name] =tar.Unifroms[name];\r\n                    return tar[name];\r\n                }\r\n                else if(name in tar.Attributes){\r\n                    tar[name] = tar.Attributes[name];\r\n                    return tar[name];\r\n                }\r\n\r\n                console.warn('program can not find attr/uniform:' + name);\r\n                tar[name] = undefined;\r\n                return null;\r\n            }\r\n        }\r\n\r\n        return new Proxy(p,handler);\r\n    }\r\n\r\n    public createTextureImage(src: string,callback?:()=>void): WebGLTexture | null{\r\n        var img = new Image();\r\n        var gl = this.gl;\r\n        var tex = gl.createTexture();\r\n        img.onload = () => {\r\n            gl.bindTexture(gl.TEXTURE_2D, tex);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, img);\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n\r\n            gl.bindTexture(gl.TEXTURE_2D,null);\r\n\r\n            console.log('init webgl texture');\r\n            if(callback!= null) callback();\r\n        };\r\n        img.src = src;\r\n        return tex;\r\n    }\r\n\r\n    public createTexture(internalFormat: number, width: number, height: number,linear:boolean = false,mipmap:boolean = false): WebGLTexture | null {\r\n        let gl = this.gl;\r\n\r\n        let tex = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, tex);\r\n        gl.texStorage2D(gl.TEXTURE_2D,1,internalFormat,width,height);\r\n        \r\n        gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,linear? gl.LINEAR: gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER, linear?( mipmap? gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR): gl.NEAREST);\r\n\r\n        gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);\r\n\r\n        if(mipmap)\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n\r\n        return tex;\r\n    }\r\n}"],"names":[],"mappings":"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"}