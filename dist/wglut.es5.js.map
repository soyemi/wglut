{"version":3,"file":"wglut.es5.js","sources":["../src/GLProgram.ts","../src/GLContext.ts"],"sourcesContent":["\r\n\r\nexport class GLProgram{\r\n\r\n    public Program: WebGLProgram;\r\n\r\n    public Attributes: { [key: string]: number } = {};\r\n    public Unifroms: { [key: string]: WebGLUniformLocation | null } = {};\r\n\r\n    public GetUnifrom(key:string):WebGLUniformLocation | null{\r\n        return this.Unifroms[key];\r\n    }\r\n\r\n    public GetAttribute(key:string):any{\r\n        return this.Attributes[key];\r\n    }\r\n\r\n    public constructor(gl: WebGLRenderingContext, program: WebGLProgram) {\r\n        this.Program = program;\r\n\r\n        const numAttrs = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\r\n        for (let i = 0; i < numAttrs; i++) {\r\n            const attrInfo = gl.getActiveAttrib(program, i);\r\n            if (attrInfo == null) continue;\r\n            const attrLoca = gl.getAttribLocation(program, attrInfo.name);\r\n            this.Attributes[attrInfo.name] = attrLoca;\r\n        }\r\n\r\n        const numUniform = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\r\n        for (let i = 0; i < numUniform; i++) {\r\n            const uniformInfo = gl.getActiveUniform(program, i);\r\n            if (uniformInfo == null) continue;\r\n            const uniformLoca = gl.getUniformLocation(program, uniformInfo.name);\r\n            this.Unifroms[uniformInfo.name] = uniformLoca;\r\n        }\r\n    }\r\n}","import { GLProgram } from \"./GLProgram\";\r\n\r\nexport class GLContext{\r\n\r\n    public gl:WebGL2RenderingContext;\r\n    private constructor(wgl:WebGL2RenderingContext){\r\n        this.gl = wgl;\r\n    }\r\n\r\n    public static createFromGL(wgl:WebGL2RenderingContext) :GLContext{\r\n        return new GLContext(wgl);\r\n    }\r\n\r\n    public static createFromCanvas(canvas:HTMLCanvasElement):GLContext | null{\r\n        let g:any = canvas.getContext('webgl2');\r\n        if(g == null){\r\n            g = canvas.getContext('webgl');\r\n        }\r\n        if(g == null) return null;\r\n        return new GLContext(g);\r\n    }\r\n\r\n    public createProgram(vsource:string,psource:string): GLProgram | null{\r\n\r\n        let gl = this.gl;\r\n        let vs = gl.createShader(gl.VERTEX_SHADER);\r\n        gl.shaderSource(vs, vsource);\r\n        gl.compileShader(vs);\r\n\r\n        if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {\r\n            console.error('compile vertex shader failed: ' + gl.getShaderInfoLog(vs));\r\n            gl.deleteShader(vs);\r\n            return null;\r\n        }\r\n\r\n        let ps = gl.createShader(gl.FRAGMENT_SHADER);\r\n        gl.shaderSource(ps, psource);\r\n        gl.compileShader(ps);\r\n\r\n        if (!gl.getShaderParameter(ps, gl.COMPILE_STATUS)) {\r\n            console.error('compile fragment shader failed: ' + gl.getShaderInfoLog(ps));\r\n            gl.deleteShader(ps);\r\n            return null;\r\n        }\r\n\r\n        let program = gl.createProgram();\r\n        gl.attachShader(program, vs);\r\n        gl.attachShader(program, ps);\r\n        gl.linkProgram(program);\r\n\r\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n            console.error('link shader program failed!:' + gl.getProgramInfoLog(program));\r\n            gl.deleteProgram(program);\r\n            gl.deleteShader(vs);\r\n            gl.deleteShader(ps);\r\n            return null;\r\n        }\r\n\r\n        if(program == null) return null;\r\n\r\n        let p = new GLProgram(gl, program);\r\n        let handler = {\r\n            get: function(tar:GLProgram | any,name:string){\r\n                if(name in tar) return tar[name];\r\n\r\n                if(name in tar.Unifroms){\r\n                    tar[name] =tar.Unifroms[name];\r\n                    return tar[name];\r\n                }\r\n                else if(name in tar.Attributes){\r\n                    tar[name] = tar.Attributes[name];\r\n                    return tar[name];\r\n                }\r\n\r\n                console.warn('program can not find attr/uniform:' + name);\r\n                tar[name] = undefined;\r\n                return null;\r\n            }\r\n        }\r\n\r\n        return new Proxy(p,handler);\r\n    }\r\n\r\n    public createTextureImage(src: string,callback?:()=>void): WebGLTexture | null{\r\n        var img = new Image();\r\n        var gl = this.gl;\r\n        var tex = gl.createTexture();\r\n        img.onload = () => {\r\n            gl.bindTexture(gl.TEXTURE_2D, tex);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, img);\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n\r\n            gl.bindTexture(gl.TEXTURE_2D,null);\r\n\r\n            console.log('init webgl texture');\r\n            if(callback!= null) callback();\r\n        };\r\n        img.src = src;\r\n        return tex;\r\n    }\r\n\r\n    public createTexture(internalFormat: number, width: number, height: number,linear:boolean = false,mipmap:boolean = false): WebGLTexture | null {\r\n        let gl = this.gl;\r\n\r\n        let tex = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, tex);\r\n        gl.texStorage2D(gl.TEXTURE_2D,1,internalFormat,width,height);\r\n        \r\n        gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,linear? gl.LINEAR: gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER, linear?( mipmap? gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR): gl.NEAREST);\r\n\r\n        gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);\r\n\r\n        if(mipmap)\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n\r\n        return tex;\r\n    }\r\n}"],"names":[],"mappings":"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"}